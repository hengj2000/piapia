var scroller,next=0,userstat,popRefresh,logged=0,loggedUser='',currentItem,grid=0,map,pin,markersArray=[],markerCluster,infowindow,bounds,locationId=[],key,dat,page="Main",ad=1,adGridCount=0,all=1;$("document").ready(function(){getSelf();setTimeout('loadSocial()',10000);$(document).keydown(function(e){switch(e.which){case 27:closeLB();break;case 37:loadNext(0);break;case 39:loadNext(1);break;case 74:scrollItem(1);break;case 75:scrollItem(0);break;default:break}});$('#lb-content').click(function(a){a.stopPropagation()})});function scrollItem(a){if(document.activeElement.tagName!='TEXTAREA'&&document.activeElement.tagName!='INPUT'){if($(".p").length>0){if(!currentItem){currentItem=$(".p").first()}if(a){currentItem=currentItem.next(".p");if(!currentItem.position()){currentItem=$(".p").last()}$(window).scrollTop(currentItem.position().top-30)}else{currentItem=currentItem.prev(".p");if(!currentItem.position()){currentItem=$(".p").first();$(window).scrollTop(0)}else{$(window).scrollTop(currentItem.position().top-30)}}}}}function getUrlParam(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b="[\?&]"+a+"=([^&#]*)";var c=new RegExp(b);var d=c.exec(window.location.href);if(d==null){return""}else{return d[1]}}function logOauth(a){if(a==0){_gaq.push(['_trackEvent','Main','oauth','login'])}else if(a==1){_gaq.push(['_trackEvent','Main','oauth','success'])}else if(a==2){_gaq.push(['_trackEvent','Main','oauth','user_denied'])}else if(a==3){_gaq.push(['_trackEvent','Main','oauth','logout'])}else if(a==4){_gaq.push(['_trackEvent','Main','oauth','oauth_error'])}}function getSelf(){$('#loading').show();$('#infobar').html("<div id='logo' style='padding-top:3px;float:left'><a href='/'><img src='/gramfeed_logo_31a.png' border='0' width='130'></a></div><div style='padding-top:12px;float:left'>/ <a class='link' onclick='logOauth(0)' href='/oauth/login'>Loading...</a></div><div style='padding-top:12px;float:right;'><a id='link-search' class='linkButton' onclick='showSearchBox()'>Search</a> | <a id='link-pop' class='linkButton' onclick='setupPopularMedia()'>Popular</a> | <a class='linkButton' href='/about'>About</a></div>");var b="http://www.gramfeed.com/accounts/self?callback=?";var c="0";if(getUrlParam('l')=='1'){logOauth(1)}else if(getUrlParam('error')=='user_denied'){logOauth(2)}else if(getUrlParam('view')=='logout'){logOauth(3)}else if(getUrlParam('error')=='oauth'){logOauth(4)}$.getJSON(b,function(a){if(a.t){logged=1;key=a.t;c=key.split('.')[0];getSelfInfo(c)}else{$('#infobar').html("<div id='logo' style='padding-top:3px;float:left'><a href='/'><img src='/gramfeed_logo_31a.png' border='0' width='130'></a></div><div style='padding-top:12px;float:left'>- <a class='link' onclick='logOauth(0)' href='/oauth/login'>Login via Instagram</a></div><div style='padding-top:12px;float:right;'><a id='link-search' class='linkButton' onclick='showSearchBox()'>Search</a> | <a id='link-pop' class='linkButton' onclick='setupPopularMedia()'>Popular</a> | <a class='linkButton' href='/about'>About</a></div>");if(getUrlParam('view')=='search'){showSearchBox()}else{setupPopularMedia()}}_gaq.push(['_trackEvent','Main','getSelf',c]);$('#loading').hide()})}function getSelfInfo(j){$('#loading').show();_gaq.push(['_trackEvent','Main','getSelfInfo',j]);var k="https://api.instagram.com/v1/users/self?access_token="+key+"&callback=?";$.getJSON(k,function(a){$('#loading').hide();if(a.meta.code==400&&a.meta.error_type=='OAuthAccessTokenException'){key=0;logged=0;$('#infobar').html("<div id='logo' style='padding-top:3px;float:left'><a href='/'><img src='/gramfeed_logo_31a.png' border='0' width='130'></a></div><div style='padding-top:12px;float:left'>- <a class='link' onclick='logOauth(0)' href='/oauth/login'>Login via Instagram</a></div><div style='padding-top:12px;float:right;'><a id='link-search' class='linkButton' onclick='showSearchBox()'>Search</a> | <a id='link-pop' class='linkButton' onclick='setupPopularMedia()'>Popular</a> | <a class='linkButton' href='/about'>About</a></div>");if(getUrlParam('view')=='search'){showSearchBox()}else{setupPopularMedia()}}else if(a.meta.code!=200){$('#content').append("<br/><div class='text2'>"+a.meta.error_message+"<div>")}else if(a.data.id){var b='';var c=a.data.id;var d=a.data.username?a.data.username:"";loggedUser=d;var e=a.data.full_name?" ("+a.data.full_name+")":"";var f=a.data.profile_picture?a.data.profile_picture:"";var g=a.data.counts.media?a.data.counts.media:"0";var h=a.data.counts.followed_by?a.data.counts.followed_by:"0";var i=a.data.counts.follows?a.data.counts.follows:"0";b+="<div id='profile_img'><img class='profile_img' src='"+f+"' width='70' height='70'></div>";b+="<div id='user_info'><div class='title'>"+d+"<span style='font-weight:normal'>"+e+"</span></div>";b+="<div class='boxes'><div class='box'><a style='text-decoration:none' href='/"+d+"'><div class='box-num'>"+g+"</div><div class='box-title'>Photos</div></a></div><div class='box'><a style='text-decoration:none' href='/"+d+"?view=followers'><div class='box-num'>"+h+"</div><div class='box-title'>Followers</div></a></div><div class='box'><a style='text-decoration:none' href='/"+d+"?view=follows'><div class='box-num'>"+i+"</div><div class='box-title'>Following</div></a></div>";b+="<div class='box-control'><div class='box-controls'><div class='button' style='float:left' onclick='showSearchBox()'>Search</div><div style='float:left;padding:3px'></div><div id='buttonLink'><div style='float:left;padding:7px' onclick='window.location = &quot;/"+d+"&quot;'>gramfeed.com/<b>"+d+"</b></div></div><div class='views' onclick='getMediaGrid("+c+")'><img src='grid.png'></div><div style='float:right;padding:3px'></div><div class='views' onclick='getMediaList()'><img src='list.png'></div><div style='clear:both'></div></div></div>";b+="</div></div><div style='clear:both;padding-bottom:10px'></div>";b+="<div style='position:relative'><div id='mapbox'><div id='map'></div><div id='adSpace'></div><div class='text3'><span onclick='mapSize(2003)'>Map Size</span> &rarr; <span onclick='mapSize(1)'>Small</span> | <span onclick='mapSize(2)'>Large</span> | <span onclick='mapSize(0)'>Hide </span> </div></div></div>";$('#header').append(b);userstat=b;document.title="Instagram Photo Feed on the Web - Gramfeed | "+d+e;$('#infobar').html("<div id='logo' style='padding-top:3px;float:left'><a href='/'><img src='/gramfeed_logo_31a.png' border='0' width='130'></a></div><div style='padding-top:12px;float:left;'>/ <a class='link' href='/"+d+"'>"+d+"</a> [<a class='link' href='/oauth/logout'>Logout</a>]</div><div style='padding-top:5px;float:right;'><span id='search-form'><span class='glass'><img src='/search-icon.png' onclick='searchPhoto()'/></span><input value='' placeholder='Search' id='search-query' type='text' onclick='scrollToTop()' onKeyPress='if ((event.which && event.which == 13) || (event.keyCode && event.keyCode == 13)) {searchPhoto();return false;} else return true;'/></span> | <a id='link-timeline' class='linkButton' onclick='showTimeline()'>My Feed</a> | <a class='linkButton' href='/instagram/likes'>My Likes</a> | <a class='linkButton' href='/"+d+"'>My Photos</a> | <a id='link-pop' class='linkButton' onclick='setupPopularMedia()'>Popular</a> | <a class='linkButton' href='/about'>About</a></div>");if(getUrlParam('view')=='search'){showSearchBox()}else if(getUrlParam('view')=='popular'){setupPopularMedia(0)}else{grid=1;getMediaGrid();setupMap();setTimeout("showFeatured(0)",1000)}}else{if(getUrlParam('view')=='search'){showSearchBox()}else{setupPopularMedia()}}$('#link-timeline').addClass('linkButton');$('#link-pop').addClass('linkButton')}).error(function(){$('#infobar').html("<div id='logo' style='padding-top:3px;float:left'><a href='/'><img src='/gramfeed_logo_31a.png' border='0' width='130'></a></div><div style='padding-top:12px;float:right;'><a id='link-search' class='linkButton' onclick='showSearchBox()'>Search</a> | <a id='link-pop' class='linkButton' onclick='setupPopularMedia()'>Popular</a> | <a class='linkButton' href='/about'>About</a></div>");$('#content').append("<br/><br/><div class='text2'>Instagram is down, try again later<div>")})}function setupMap(){var a={zoom:13,mapTypeControl:false,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,position:google.maps.ControlPosition.TOP_LEFT},navigationControl:true,scrollwheel:false,navigationControlOptions:{style:google.maps.NavigationControlStyle.SMALL},mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("map"),a)}function mapSize(a){if(a==0){$("#map").animate({height:'0px'},500);toggleAds(0,1)}else if(a==1){$("#map").animate({height:'248px'},500,function(){google.maps.event.trigger(map,"resize");mapBounds()})}else if(a==2){$("#map").animate({height:'500px'},500,function(){google.maps.event.trigger(map,"resize");mapBounds()});toggleAds(0,1)}else{mapBounds()}}function mapBounds(){map.fitBounds(bounds);if(map.getZoom()<2){map.setZoom(2)}else if(map.getZoom()>16){map.setZoom(16)}}function toggleAds(a,b){if(markersArray.length&&ad){if(a){$("#mapbox").animate({width:'555px'},0,function(){google.maps.event.trigger(map,"resize");mapBounds()});$('#adSpace').append("<div class='text3' onclick='toggleAds(0,1)'> &uarr; Close</div>")}else{$('#adSpace').html("");$("#mapbox").animate({width:'100%'},100,function(){google.maps.event.trigger(map,"resize");mapBounds()});if(b){ad=0}}}}function getAds(){var a='';a+='<div id="grid-cell" onmouseover="moreInfo(1,this)" onmouseout="moreInfo(0,this)"><a onclick="logAdClick(1)" target="_blank" href="http://stickygram.com/?pid=37"><img class="photo-grid" src="https://lh3.googleusercontent.com/-fPIH3RU0WuA/Txr_KU1rD1I/AAAAAAAAABM/oq9w7K-8rHE/s800/stickygram_ad_200.png" alt="Making photo albums easy." width="200" height="200" border="0" /></a><div class="moreInfo" style="bottom:15px;text-align:center">Make Instagram Magnets &uarr;</div></div>';a+='<div id="grid-cell" onmouseover="moreInfo(1,this)" onmouseout="moreInfo(0,this)"><a onclick="logAdClick(3)" target="_blank" href="http://www.keepsy.com?p=gramfeed"><img class="photo-grid" src="http://www.keepsy.com/img/banner_150x150_gray.png" alt="Making photo albums easy." width="200" height="200" border="0" /></a><div class="moreInfo" style="bottom:15px;text-align:center">Print Real Photo Albums &uarr;</div></div>';a+='<div id="grid-cell" onmouseover="moreInfo(1,this)" onmouseout="moreInfo(0,this)"><a onclick="logAdClick(5)" target="_blank" href="http://www.casetagram.com?affkey=Ca9SqE8Czw86"><img class="photo-grid" src="https://lh4.googleusercontent.com/-z4JsN0vGeOA/T1cCPDrAWDI/AAAAAAAAACY/EZM7kB2DQC0/s800/gramfeed_banner.jpg" alt="Make Instagram iPhone case" width="200" height="200" border="0" /></a><div class="moreInfo" style="bottom:15px;text-align:center">Make Instagram iPhone case &uarr;</div></div>';a+='<div id="grid-cell" onmouseover="moreInfo(1,this)" onmouseout="moreInfo(0,this)"><a onclick="logAdClick(5)" target="_blank" href="http://www.gramfeed.com/about"><img class="photo-grid" src="https://lh6.googleusercontent.com/-Y3WFeV_g2M0/T1cJKQYJ3OI/AAAAAAAAACw/yl23SbmSSc4/s800/your_ad.png" alt="Your Ad here" width="200" height="200" border="0" /></a><div class="moreInfo" style="bottom:15px;text-align:center">Advertise here &uarr;</div></div>';return a}function adGrid(){if(adGridCount==0){$('#content').append('<div id="grid-cell" onmouseover="moreInfo(1,this)" onmouseout="moreInfo(0,this)"><a onclick="logAdClick(1)" target="_blank" href="http://stickygram.com/?pid=37"><img class="photo-grid" src="https://lh3.googleusercontent.com/-fPIH3RU0WuA/Txr_KU1rD1I/AAAAAAAAABM/oq9w7K-8rHE/s800/stickygram_ad_200.png" alt="Making photo albums easy." width="200" height="200" border="0" /></a><div class="moreInfo" style="bottom:15px;text-align:center">Make Instagram Magnets &uarr;</div></div>')}else if(adGridCount==1){$('#content').append('<div id="grid-cell" onmouseover="moreInfo(1,this)" onmouseout="moreInfo(0,this)"><a onclick="logAdClick(3)" target="_blank" href="http://www.keepsy.com?p=gramfeed"><img class="photo-grid" src="http://www.keepsy.com/img/banner_150x150_gray.png" alt="Making photo albums easy." width="200" height="200" border="0" /></a><div class="moreInfo" style="bottom:15px;text-align:center">Print Real Photo Albums &uarr;</div></div>')}else if(adGridCount==2){$('#content').append('<div id="grid-cell" onmouseover="moreInfo(1,this)" onmouseout="moreInfo(0,this)"><a onclick="logAdClick(5)" target="_blank" href="http://www.casetagram.com?affkey=Ca9SqE8Czw86"><img class="photo-grid" src="https://lh4.googleusercontent.com/-z4JsN0vGeOA/T1cCPDrAWDI/AAAAAAAAACY/EZM7kB2DQC0/s800/gramfeed_banner.jpg" alt="Make Instagram iPhone case" width="200" height="200" border="0" /></a><div class="moreInfo" style="bottom:15px;text-align:center">Make Instagram iPhone case &uarr;</div></div>')}adGridCount++}function logAdClick(a){if(a==1){adName='stickygram'}else if(a==2){adName='blurb'}else if(a==3){adName='keepsy'}else if(a==4){adName='tinyprints'}else if(a==5){adName='casetagram'}else if(a==6){adName='your_ad'}_gaq.push(['_trackEvent',page,'adClick',adName])}function showTimeline(){$('#header').hide();$('#header').html(userstat).fadeIn('slow');setupMap();getMediaGrid()}function showSearchBox(){_gaq.push(['_trackEvent','Main','showSearchBox',':'+loggedUser]);clearInterval(scroller);clearInterval(popRefresh);next=0;$('#content').html('').show();$('#content').width(460);$('#more').hide();$('#loading').hide();$('#link-timeline').removeClass('linkButtonS');$('#link-pop').removeClass('linkButtonS');$('#header').hide();$('#header').html("<div class='text2'>Search Instagram Photos, People and Places</div><div style='text-align:center'><input id='input' class='search' size= type='text' onKeyPress='if ((event.which && event.which == 13) || (event.keyCode && event.keyCode == 13)) {searchAny();return false;} else return true;'/><br><span style='color:#776; font-size:8pt'>Example: John Smith, #food, Tokyo</span></div>").fadeIn('slow');$('#header').append("<br/><div style='text-align:center'><div class='button' onclick='searchTag()'>Search Photos</div>&nbsp;&nbsp;&nbsp;<div class='button' onclick='searchUser()'>Search People</div>&nbsp;&nbsp;&nbsp;<div class='button' onclick='searchLocation()'>Search Place</div></div><br/>")}function findPeople(){var a=$("#input").val();showSearchBox();$("#input").val(a);searchUser()}function searchAny(){if($('#input').val()==""){alert("Nothing to search")}else if($('#input').val()[0]=='#'){searchTag()}else if($('#input').val()[0]=='@'){searchUser()}else if($('#input').val()[0]=='!'){searchLocation()}else{searchTag()}}function searchPhoto(){if($('#search-query').val()==""){alert("Nothing to search")}else{var a=$('#search-query').val();if(a[0]=='#'){a=a.substring(1)}a=a.split(' ')[0];var b="!@$%^&*()+=-[];,./{}|/:<>?~";for(var i=0;i<a.length;i++){if(b.indexOf(a.charAt(i))!=-1){alert("Your search has special characters. Search can only be one word.");return}}_gaq.push(['_trackEvent',page,'searchPhoto',a+':'+loggedUser]);window.location="/instagram/tags/"+a}}function searchTag(){if($('#input').val()==""){alert("Nothing to search")}else{var q=$('#input').val();if(q[0]=='#'){q=q.substring(1)}_gaq.push(['_trackEvent','Main','searchTag',q+':'+loggedUser]);window.location="/instagram/tags/"+q}}function searchLocation(){var q=$('#input').val();if(q[0]=='!'){q=q.substring(1)}_gaq.push(['_trackEvent','Main','searchLocation',q+':'+loggedUser]);window.location="/instagram/places?location="+q}function searchUser(){if($('#input').val()==""){alert("Nothing to search")}else{var q=$('#input').val();if(q[0]=='@'){q=q.substring(1)}_gaq.push(['_trackEvent','Main','searchUser',q+':'+loggedUser]);q=q.toLowerCase();if(q){$('#loading').show();var c;if(logged){c="https://api.instagram.com/v1/users/search?q="+q+"&access_token="+key+"&callback=?"}else{c="https://api.instagram.com/v1/users/search?q="+q+"&client_id=b59fbe4563944b6c88cced13495c0f49&callback=?"}$.getJSON(c,function(a){if(a.data.length>0){var b="<br/>",user_name,full_name,profile_picture,website,bio;for(var i=0;i<a.data.length;i++){user_name=a.data[i].username?a.data[i].username:"";full_name=a.data[i].full_name?" ("+a.data[i].full_name+")":"";website=a.data[i].website?a.data[i].website:"";bio=a.data[i].bio?a.data[i].bio:"";profile_picture=a.data[i].profile_picture?a.data[i].profile_picture:"";b+="<div class='user-list' style='border-bottom:1px dotted #999'><div class='user' style='float:left'><a style='text-decoration:none' href=/"+user_name+"><img class='photo_user' src='"+profile_picture+"' width=48 height=48 title='"+user_name+"' /></a></div><div style='float:left;padding-left:15px;width:350px;min-height:48px;text-align:left'><div style='color:#000'>"+user_name+full_name+"</div><div style='font-weight:normal;font-size:8pt;color:#666'>"+bio+"</div><div><a style='font-weight:normal;font-size:8pt;color:#444' href='"+website+"' target='_blank'>"+website+"</a></div></div><div style='float:right;padding-top:10px'><a style='text-decoration:none;color:#000;font-size:24px' href='/"+user_name+"' target='_blank'> &rarr; </a></div><div style='clear:both'></div></div>"}$('#content').html(b)}else{$('#content').html("<br/><br/><div class='text2'>Cannot find user '"+q+"'</div>")}$('#loading').hide()})}else{$('#content').html("<br/><br/><div class='text2'>Nothing to search</div>")}}}function setupPopularMedia(){getPopularMedia();popRefresh=setInterval(getPopularMedia,600000)}function getPopularMedia(){_gaq.push(['_trackEvent','Main','popularMedia',':'+loggedUser]);clearInterval(scroller);$('#content').html("").show();$('#header').hide();$('#more').hide();$('#content').width(930);$('#link-timeline').removeClass('linkButtonS');$('#link-pop').addClass('linkButtonS');next=0;$('#content').html("</br>");if(getUrlParam('view')=='logout'){$('#content').append("<div class='text2' style='background-color:#eea;border:1px dashed #997'><br/>You are logged out of Gramfeed and <a class='link2' href='http://instagram.com'>Instagram</a></div>");$('#content').append('<div style="display:none"><iframe src="https://instagram.com/accounts/logout/" width="0" height="0"></div>')}else if(getUrlParam('error')=='user_denied'){$('#content').append("<div class='text2' style='background-color:#eea;border:1px dashed #997'><br/>Authorization via Instagram is necessary to access more features<br><br><a class='link' onclick='logOauth(0)' href='/oauth/login'><img src='Instagram_signin.png' border='0'></a></div>")}else if(getUrlParam('error')){$('#content').append("<div class='text2' style='background-color:#eea;border:1px dashed #997'><br/>Error occured during login, try again<br><br><a class='link' onclick='logOauth(0)' href='/oauth/login'><img src='Instagram_signin.png' border='0'></a></div>")}else if(!logged){$('#content').append("<div class='text2' style='background-color:#eea;border:1px dashed #997'><br/>Login to view your <a class='link2' href='http://instagram.com'>Instagram</a> photo feed, likes, followers and more...<br><br><a class='link' onclick='logOauth(0)' href='/oauth/login'><img src='Instagram_signin.png' border='0'></a></div>")}$('#content').append("<div style='padding-top:30px;clear:both'></div>");$('#content').append("<div class='text2' style='text-align:center;margin:auto;border:1px solid #777;background-color:#eee;-moz-box-shadow: 0 0 6px rgba(0, 0, 0, 0.5);-webkit-box-shadow: 0 0 6px rgba(0, 0, 0, 0.5);box-shadow: 0 0 6px rgba(0, 0, 0, 0.5);'><div><input id='input' class='search' size= type='text' onKeyPress='if ((event.which && event.which == 13) || (event.keyCode && event.keyCode == 13)) {searchTag();return false;} else return true;'/>&nbsp;&nbsp;<span class='button' onclick='searchTag()'>Search Photos</span>&nbsp;&nbsp;<span class='button' onclick='findPeople()'>Find People</span>&nbsp;&nbsp;<span class='button' onclick='window.location=&quot;/instagram/map&quot;'>Map Search</span><br><span style='color:#333; font-weight:normal;font-size:8pt;; padding-right:350px'>Example: food, cat, autumn</span></div></div>");var a="";a+="<br/><div class='text2' style='text-align:center;margin:auto;border:1px dashed #ccc;background-color:#eee;padding:20px;font-size:16px'>";a+="<span style='padding:2px;color:#000;text-decoration:none;font-weight:normal;font-size:12px;float:left' >featured tags &rarr;</span>";for(var i=0;i<featured.tags.length;i++){a+="<a style='padding:10px;color:#444;text-decoration:none' href='/instagram/tags/"+featured.tags[i]+"'>#"+featured.tags[i]+"</a>"}a+="</div>";$('#content').append(a);$('#content').append("<div class='text2' style='font-size:14pt;padding-top:50px'>Currently Popular on Instagram <a onclick='displayPopMedia()'><img src='refresh.png' border=0 title='Refresh' style='cursor:pointer' /></a><div>");$('#content').append("<div id='popular'></div>");displayPopMedia()}function displayPopMedia(){dat=new Array();$('#loading').show();var g;if(logged){g="https://api.instagram.com/v1/media/popular?access_token="+key+"&callback=?"}else{g="https://api.instagram.com/v1/media/popular?client_id=b59fbe4563944b6c88cced13495c0f49&callback=?"}$('#popular').html('');$.getJSON(g,function(a){for(var i=0;i<a.data.length;i++){var b=dat.length;dat[b]=a.data[i];var c=a.data[i].images.low_resolution.url?a.data[i].images.low_resolution.url:"";var d=getRelativeDate(a.data[i].created_time);var e;var e;var f="";if(a.data[i].location){f="&#8855;"}a.data[i].user_has_liked?e="&hearts;":e="&#9825;";$('#popular').append("<div id='grid-cell' onmouseover='moreInfo(1,this)' onmouseout='moreInfo(0,this)'><a style='cursor:pointer' onclick='showPhoto("+b+")'><img class='photo-grid' src="+c+" width='200' height='200' border='0'/></a><div style='position:absolute;top:5px;left:5px;z-index:1;'><a href='/"+a.data[i].user.username+"' target='_blank'><img class='photo_user' src='"+a.data[i].user.profile_picture+"' width=40 height=40 title='"+a.data[i].user.username+"' border=0 /></a></div><div class='moreInfo' style='top:15px'><a style='color:#000;text-decoration:none' href='/instagram/"+a.data[i].id+"' target='_blank'><div style='float:right'>"+d+" "+f+"</div></a></div><div class='moreInfo' style='bottom:15px;'><a style='color:#000;text-decoration:none' href='/instagram/"+a.data[i].id+"' target='_blank'><div style='float:left'>&#9776; "+a.data[i].comments.count+"</div></a><div style='float:right' onclick='if(logged)postLikeGrid(this,&quot;"+a.data[i].id+"&quot;,"+a.data[i].likes.count+")'>"+e+"</div><div style='float:right'><a style='color:#000;text-decoration:none' href='/instagram/"+a.data[i].id+"' target='_blank'>"+a.data[i].likes.count+"</a>&nbsp;</div><div style='clear:both'></div></div></div>")}$('#popular').append("<div style='clear:both;border-bottom:0px dotted #666;border-top:1px dotted #666;padding:15px 0px 15px 0px'>"+getAds()+"</div>");$('#popular').append("<div class='text2' style='clear:both;border-bottom:0px dotted #666;border-top:1px dotted #666'><a class='link2' href='http://twitter.com/gramfeed'>@gramfeed</a> created by <a class='link2' href='http://twitter.com/krisrak'>@krisrak</a></div>");$('#loading').hide()}).error(function(){$('#infobar').html("<div id='logo' style='padding-top:3px;float:left'><a href='/'><img src='/gramfeed_logo_31a.png' border='0' width='130'></a></div><div style='padding-top:12px;float:right;'><a id='link-search' class='linkButton' onclick='showSearchBox()'>Search</a> | <a id='link-pop' class='linkButton' onclick='setupPopularMedia()'>Popular</a> | <a class='linkButton' href='/about'>About</a></div>");$('#content').append("<br/><br/><div class='text2'>Instagram is down, try again later<div>")})}function getMediaNextPage(){if(next&&!plb){$('#more').html("LOADING... [RETRY]");var a=next+"&callback=?";if(grid==1){displayMediaGrid(a)}else{displayMediaList(a)}}}function scroll(){if(($(document).height()-$(window).height()-$(window).scrollTop())<700){getMediaNextPage()}}function showInfobox(a){if(a){grid=2;$('#content').animate({width:'780px'},500,function(){$('.infobox').show()})}else{$('.infobox').hide();$('#content').animate({width:'425px'},500,function(){grid=0})}}function getMediaList(){_gaq.push(['_trackEvent','Main','getFeedMediaList',':'+loggedUser]);grid=0;$('#helpbox').fadeIn('slow');setInterval(function(){$('#helpbox').fadeOut('slow')},7000);clearInterval(scroller);clearInterval(popRefresh);$('#header').fadeIn('slow');$('#content').html("").hide();$('#content').width(425);$("#mapbox").slideUp();$('#link-timeline').addClass('linkButtonS');$('#link-pop').removeClass('linkButtonS');next=0;var a="https://api.instagram.com/v1/users/self/feed?access_token="+key+"&callback=?";dat=new Array();displayMediaList(a)}function displayMediaList(s){_gaq.push(['_trackEvent','Main','displayFeedMediaList',':'+loggedUser]);$('#loading').show();clearInterval(scroller);$.getJSON(s,function(a){for(var i=0;i<a.data.length;i++){var b=dat.length;dat[b]=a.data[i];var c="";$('#more').html("LOAD MORE");next=a.pagination?a.pagination.next_url:null;if(!next){$('#more').hide()}else{$('#more').show()}var d=a.data[i].images.low_resolution.url?a.data[i].images.low_resolution.url:"";var e=a.data[i].user.username?"<a class='link' href='/"+a.data[i].user.username+"'><div class='info2'>"+a.data[i].user.username+"</div></a>":"";var f=a.data[i].user.profile_picture?"<span class='user'><a href='/"+a.data[i].user.username+"'><img class='photo_user' src='"+a.data[i].user.profile_picture+"' width=48 height=48 title='"+a.data[i].user.username+"'/></a></span>":"";var g="";if(a.data[i].caption){g=a.data[i].caption.text?"<div class='photo_title'>"+a.data[i].caption.text+"</div>":""}var h="";if(a.data[i].created_time){h="<div class='info2'>"+getRelativeDate(a.data[i].created_time)+"</div>"}var k="";if(a.data[i].location){k=a.data[i].location.name?"<a class='link' href='/instagram/places/"+a.data[i].location.id+"' ><div class='info'>@ "+a.data[i].location.name+"</div></a>":""}var l="";var m="";var n="";var o="";if(a.data[i].comments){n=a.data[i].comments.count?a.data[i].comments.count==1?"<div class='info'>1 Comment &rarr;</div>":"<div class='info'>"+a.data[i].comments.count+" Comments &rarr;</div>":"<div class='info'>0 Comments</div>";if(a.data[i].comments.count>8){l=" <a id='moreComments' class='info' style='cursor:pointer;' onclick='getComments($(this).parent(),&quot;"+a.data[i].id+"&quot;)'>+ more</a>"}}if(a.data[i].comments.count>0){m="<div class='info' style='padding-top:10px;color:#000'>Comments:</div>";for(var j=0;j<a.data[i].comments.data.length;j++){var p=a.data[i].comments.data[j].text;p=p.replace(/(^|\s)#(\w+)/g,'$1#<a style="color:#000;" href="/instagram/tags/$2">$2</a>');p=p.replace(/(^|\s)@(\w+)/g,'$1@<a style="color:#000;" href="/$2">$2</a>');o+="<div class='user' style='float:left;padding-left:10px'><a style='text-decoration:none' href=/"+a.data[i].comments.data[j].from.username+"><img class='photo_user' src='"+a.data[i].comments.data[j].from.profile_picture+"' width=32 width=32 title='"+a.data[i].comments.data[j].from.username+"' /></a></div><div class='comment'><b>"+a.data[i].comments.data[j].from.username+"</b>: "+p+"</div><div style='clear:both;border-top:1px dotted #ccc;padding-top:3px;'></div>"}}var q="";if(a.data[i].likes){q=a.data[i].likes.count?a.data[i].likes.count==1?"<div class='info'>1 Like</div>":"<div class='info'>"+a.data[i].likes.count+" Likes</div>":"<div class='info'>0 Likes</div>"}var r;if(a.data[i].user_has_liked==1){r="&nbsp;&nbsp;<a><img class='liked' src='/liked.png' title='like' border='0' /></a>"}else{r="&nbsp;&nbsp;<a><img class='liker' onclick='postLike(this, &quot;"+a.data[i].id+"&quot;)' src='/like.png' title='like' border='0' /></a>"}g=g.replace(/(^|\s)#(\w+)/g,'$1#<a style="color:#000;" href="/instagram/tags/$2">$2</a>');g=g.replace(/(^|\s)@(\w+)/g,'$1@<a style="color:#000;" href="/$2">$2</a>');c+="<br/><br/><div class='photobox' style='float:left'>";c+="<div style='float:left; width:50px;text-align:left'>"+f+"</div>";c+="<div style='float:left; width:20px;text-align:left'>"+e+"</div>";c+="<div style='float:right;width:330px;text-align:right'>"+h+k+"</div>";c+="<div style='clear:both'></div>";c+="<a style='cursor:pointer' onclick='showPhoto("+b+")'><img class='photo' src="+d+" border='0' /></a>"+g;c+="<div style='float:left; width:200px;text-align:left' ><a class='link' href='/instagram/"+a.data[i].id+"' >"+q+"</a>"+r+"</div>";c+="<div style='float:right;width:200px;text-align:right'><a class='link' onclick='showInfobox(1)' >"+n+"</a><a class='link' onclick='showInfobox(1)'><div class='info'>Add Comment &rarr;</div></a></div>";c+="<div style='clear:both'></div>";c+="</div>";c+="<div class='infobox'><div class='commentbox'><div style='text-align:right' onclick='showInfobox(0)'><span class='info'>&larr; Close</span></div>"+m+"<div class='commentlist' style='max-height:330px;overflow:auto'>"+o+"</div>"+l;if(logged){c+="<div id='commentInput' class='info' style='color:#000;text-align:left;padding-top:12px'><textarea id='comment' name='comment' cols='40' rows='3' style='width:290px;'></textarea><a id='postComment' onclick='postComment($(this).parent(),&quot;"+a.data[i].id+"&quot;)'><br/><span class='post'>Add Comment</span></a><span id='response' class='info'></span></div>"}else{c+="<a class='link' onclick='logOauth(0)' href='/oauth/login'><div class='info'><br/>Login via Instagram to add comments</div></a>"}c+="</div></div>";c+="<div style='clear:both;'></div>";$('#content').append("<div class='p'>"+c+"</div>").fadeIn('slow')}$('.commentlist').emoji();$('.photo_title').emoji();$('#loading').hide();if(grid==2){$('.infobox').show()}if(next){scroller=setInterval(function(){scroll()},500)}})}function getMediaGrid(a){_gaq.push(['_trackEvent','Main','getFeedMediaGrid',':'+loggedUser]);grid=1;adGridCount=0;locationId=[];clearMarkers();bounds=new google.maps.LatLngBounds();clearInterval(scroller);clearInterval(popRefresh);$('#header').fadeIn('slow');$('#content').html("").show();$('#more-users').hide();$('#content').width(930);$('#link-timeline').addClass('linkButtonS');$('#link-pop').removeClass('linkButtonS');next=0;var b="https://api.instagram.com/v1/users/self/feed?access_token="+key+"&callback=?";$('#content').append("<div class='spacer' style='padding-top:20px'></div><div class='placeTitle'></div>");dat=new Array();displayMediaGrid(b)}function displayMediaGrid(g){_gaq.push(['_trackEvent','Main','displayFeedMediaGrid',':'+loggedUser]);var h=0;$('#loading').show();clearInterval(scroller);$.getJSON(g,function(a){next=a.pagination?a.pagination.next_url:null;$('#more').html("LOAD MORE");if(!next){$('#more').hide()}else{$('#more').show()}for(var i=0;i<a.data.length;i++){var b=dat.length;dat[b]=a.data[i];var c=a.data[i].images.low_resolution.url?a.data[i].images.low_resolution.url:"";var d=getRelativeDate(a.data[i].created_time);var e,location_Id,location_Name,content;var e;var f="";if(a.data[i].location){f="&#8855;"}a.data[i].user_has_liked?e="&hearts;":e="&#9825;";if(a.data[i].location==null||!a.data[i].location.latitude||!a.data[i].location.longitude){location_Id=0}else if(!a.data[i].location.id){location_Id="9000000000"+a.data[i].id;content="<div style='float:left'><a onclick='showPhoto("+b+")'><img src='"+c+"' height='64' width='64' border='0'></a></div><div style='float:left;padding:20px;font-size:8pt;font-weight:bold'>Photo by @<a href='/"+a.data[i].user.username+"' target='_blank'>"+a.data[i].user.username+"</a></div>";createMarker(a.data[i].location.latitude,a.data[i].location.longitude,null,location_Id,content)}else{location_Id=a.data[i].location.id;location_Name=a.data[i].location.name;content="<div style='float:left'><a onclick='showPhoto("+b+")'><img src='"+c+"' height='64' width='64' border='0'></a></div><div style='float:left;padding:3px;padding-left:15px;font-size:8pt;font-weight:bold;'>Photo by @<a href='/"+a.data[i].user.username+"' target='_blank'>"+a.data[i].user.username+"</a><br/><br/>@ "+location_Name+"<br/><a href='/instagram/places/"+a.data[i].location.id+"' target='_blank'>More Photos here</a> &rarr;</div>";locationId.push(a.data[i].location.id);h=0;for(var j=0;j<locationId.length-1;j++){if(a.data[i].location.id==locationId[j]){h=1}}if(!h){createMarker(a.data[i].location.latitude,a.data[i].location.longitude,location_Name,location_Id,content)}}$('#content').append("<div class='"+location_Id+"' id='grid-cell' onmouseover='moreInfo(1,this)' onmouseout='moreInfo(0,this)'><a style='cursor:pointer' onclick='showPhoto("+b+")'><img class='photo-grid' src="+c+" width='200' height='200' border='0'/></a><div style='position:absolute;top:5px;left:5px;z-index:1'><a href='/"+a.data[i].user.username+"' target='_blank'><img class='photo_user' src='"+a.data[i].user.profile_picture+"' width=40 height=40 title='"+a.data[i].user.username+"' border=0 /></a></div><div class='moreInfo' style='top:15px'><a style='color:#000;text-decoration:none' href='/instagram/"+a.data[i].id+"' target='_blank'><div style='float:right'>"+d+" "+f+"</div></a></div><div class='moreInfo' style='bottom:15px;'><a style='color:#000;text-decoration:none' href='/instagram/"+a.data[i].id+"' target='_blank'><div style='float:left'>&#9776; "+a.data[i].comments.count+"</div></a><div style='float:right' onclick='if(logged)postLikeGrid(this,&quot;"+a.data[i].id+"&quot;,"+a.data[i].likes.count+")'>"+e+"</div><div style='float:right'><a style='color:#000;text-decoration:none' href='/instagram/"+a.data[i].id+"' target='_blank'>"+a.data[i].likes.count+"</a>&nbsp;</div><div style='clear:both'></div></div></div>")}if(markerCluster)markerCluster.clearMarkers();markerCluster=new MarkerClusterer(map,markersArray,{maxZoom:16});mapBounds();$('#content').fadeIn('slow');$('#loading').hide();$('.placeTitle').hide();if(next){adGrid();scroller=setInterval(function(){scroll()},500)}})}function moreInfo(a,b){a?$(b).children('.moreInfo').show():$(b).children('.moreInfo').hide()}function createMarker(a,b,c,d,e){$("#mapbox").slideDown();google.maps.event.trigger(map,"resize");var f=new google.maps.MarkerImage('/marker1.png',new google.maps.Size(30,28),new google.maps.Point(0,0),new google.maps.Point(9,28));var g=new google.maps.Marker({position:new google.maps.LatLng(a,b),map:map,title:c,icon:f});bounds.extend(new google.maps.LatLng(a,b));google.maps.event.addListener(g,"click",function(){if(infowindow)infowindow.close();infowindow=new google.maps.InfoWindow({content:e});infowindow.open(map,g);google.maps.event.addListener(infowindow,'closeclick',function(){showLocationPhotos(1,d,c)});showLocationPhotos(0,d,c)});markersArray.push(g);return g}function clearMarkers(){clearInterval(scroller);if(markersArray){for(m in markersArray){markersArray[m].setMap(null)}markersArray.length=0}}function getRelativeDate(a){var b=new Date();var c=b.getTime()-(a*1000);var d=c/1000/60;var e=c/1000/60/60;var f=c/1000/60/60/24;var g=c/1000/60/60/24/365;if(Math.round(d)==1){return("1 min ago")}else if(e<1.01){return(Math.round(d)+" min ago")}else if(Math.round(e)==1){return("1 hour ago")}else if(f<1.01){return(Math.round(e)+" hours ago")}else if(Math.round(f)==1){return("1 day ago")}else if(g<1.01){return(Math.round(f)+" days ago")}else if(Math.round(g)==1){return("1 year ago")}else{return(Math.round(g)+" years ago")}}function showLocationPhotos(a,b,c){placeId=b;all=a;clearInterval(scroller);if(a){$('#content').children().fadeIn('slow');$('.placeTitle').slideUp();if(next){scroller=setInterval(function(){scroll()},500);$('#more').show()}if(infowindow)infowindow.close()}else{$('#'+b).css('background-color','#999');$('#content').children().hide();$('#more').hide();$('.spacer').show();if(c){$('.placeTitle').html("<b style='text-decoration:underline;font-size:12px;cursor:pointer' onclick='showLocationPhotos(1,0,0)'>Show All</b> . <a style='color:#222;font-size:12px;' href='/instagram/places/"+b+"' target='_blank'>More at this location</a><br/><a class='placeTitleLink' href='/instagram/places/"+b+"' target='_blank'>"+c+"</a>").slideDown()}else{$('.placeTitle').html("<b style='text-decoration:underline;font-size:12px;cursor:pointer' onclick='showLocationPhotos(1,0,0)'>Show All</b>").slideDown()}$('#content .'+b).fadeIn('slow')}}function postLike(b,c){_gaq.push(['_trackEvent','Main','postLike',c+':'+loggedUser]);var d="http://www.gramfeed.com/instagram/post/v1/media/"+c+"/likes?callback=?";$.getJSON(d,function(a){if(a.meta.code==200){$(b.parentNode).html("<img class='liked' src='liked.png' title='like' border='0' />")}})}function postLikeGrid(b,c,d){_gaq.push(['_trackEvent','Main','postLike',c+':'+loggedUser]);var e="http://www.gramfeed.com/instagram/post/v1/media/"+c+"/likes?callback=?";$.getJSON(e,function(a){if(a.meta.code==200){$(b).html("&hearts;")}})}function postComment(b,d){_gaq.push(['_trackEvent','Main','postComment',d+':'+loggedUser]);b.children('#response').html('<img src="/20_loading_icon.gif">');var c=encodeURIComponent(b.children('#comment').val());if(c){var e="http://www.gramfeed.com/instagram/post/v1/media/"+d+"/comments?text="+c+"&callback=?";$.getJSON(e,function(a){if(a.error){b.children('#response').html('Error Posting Comment')}else if(a.meta.code==200){b.children('#response').html('Comment posted, Thank You');b.children('#comment').val('');b.children('#comment').blur();getComments(b.parent(),d)}else{b.children('#response').html('Error Posting Comment')}})}else{b.children('#response').html("Please Type a comment")}}function getComments(d,e){_gaq.push(['_trackEvent','Main','getComments',e+':'+loggedUser]);d.children('.commentlist').prepend('<img src="/20_loading_icon.gif">');var f="";if(logged){f="https://api.instagram.com/v1/media/"+e+"/comments?access_token="+key+"&callback=?"}else{f="https://api.instagram.com/v1/media/"+e+"/comments?client_id=b59fbe4563944b6c88cced13495c0f49&callback=?"}$.getJSON(f,function(a){var b="";for(var j=0;j<a.data.length;j++){var c=a.data[j].text;c=c.replace(/(^|\s)#(\w+)/g,'$1#<a style="color:#000;" href="/instagram/tags/$2">$2</a>');c=c.replace(/(^|\s)@(\w+)/g,'$1@<a style="color:#000;" href="/$2">$2</a>');b+="<div class='user' style='float:left;padding-left:10px'><a style='text-decoration:none' href=/"+a.data[j].from.username+"><img class='photo_user' src='"+a.data[j].from.profile_picture+"' width=32 width=32 title='"+a.data[j].from.username+"' /></a></div><div class='comment'><b>"+a.data[j].from.username+"</b>: "+c+"</div><div style='clear:both;border-top:1px dotted #ccc;padding-top:3px;'></div>"}d.children('.commentlist').html(b);d.children('.commentlist').emoji();d.children('#moreComments').html("&crarr; Refresh")})}$.fn.emoji=function(){return this.each(function(){$(this).html(function(i,b){return b.replace(/([\ue001-\ue537])/g,function(s,a){return'<img src="http://www.iemoji.com/images/bigmojis/'+a.charCodeAt(0).toString(16)+'.png" alt="emoji" height="16" width="16" />'})})})};function loadSocial(){var a="View Instagram Photos on the Web";var b="<a style='border:2px'href='http://twitter.com/share' class='twitter-share-button' data-url='http://gramfeed.com' data-text='"+a+"' data-count='none' data-via='gramfeed' data-related='krisrak:creator'>Tweet</a><script type='text/javascript' src='http://platform.twitter.com/widgets.js'></"+"script>&nbsp;";$("#share").html(b)}